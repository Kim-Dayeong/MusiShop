<html lang="ko"
      xmlns:th="http://thymeleaf.org"
      xmlns:layout="http://ultraq.net.nz/thymeleaf/layout"
>
<meta charset="UTF-8">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />

    <style>
        .comment-box {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
        }
    </style>

    <title>게시글</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<div class="layout">

    <table>
        <tbody>
        <h2 th:text = "${boards.title}"></h2>
        <h2 th:text = "${boards.content}"></h2>
        <h2 th:text = "${boards.nickname}"></h2>
        <h2 th:text = "${boards.view}"></h2>
        <h2 th:text = "${boards.id}"></h2>

        </tbody>

    </table>
    <div class="mb-3">
        <label for="exampleFormControlTextarea1" class="form-label">Example textarea</label>
        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
    </div>

    <form action="/board/{id}/comment" method="post" th:action="@{'/board/' + ${id} + '/comment'}">
        <input type="text" name="content" placeholder="내용"/> <br/>
        <button>등록</button>
    </form>




    <a th:href="@{/board/update/{id}(id=${boards.id})}">수정</a>
    <button id="deleteButton" data-id="${board.id}">게시글 삭제</button>
    <button id="bookmarkButton" data-id="${board.id}">북마크</button>
</div>

<div th:each="i : ${comments}" class="comment-box">
    <div>
        <p>Username: <span th:text="${i.username}"></span></p>
        <p>Nickname: <span th:text="${i.nickname}"></span></p>
        <p>Content: <span th:text="${i.content}"></span></p>
        <p>Create Date: <span th:text="${i.createDate}"></span></p>
    </div>
</div>

<!-- Ajax 스크립트 -->

<script th:inline="javascript">
    $(document).ready(function() {
        // 삭제 버튼 클릭 시
        $("#deleteButton").click(function() {

            var boardId = [[${boards.id}]];

            $.ajax({
                type: "GET",
                url: "/board/delete/" + boardId,

            }).done((res) => {
                if(res.data == true){ // 삭제 완료
                    alert(res.msg);
                    window.location.replace("/");
                } else {
                    alert(res.msg);
                }
            }).fail((err) => {
                console.log('상태코드 200 밖에 없어서 실행 안됨')
                alert("예외 에러 발생",err);
            })
        });
    });
</script>

<script th:inline="javascript">
    $(document).ready(function() {
        // 북마크 토글 버튼 클릭 시
        $("#bookmarkButton").click(function () {

            var boardId = [[${boards.id}]];

            // Ajax 요청
            $.ajax({
                type: "GET",
                url: "/board/bookmark/" + boardId
            }).done((res) => {
                if(res.data == true){ // 북마크 추가
                    alert(res.msg);
                }else{ // 북마크 해제
                    alert(res.msg);
                }

            }).fail((err) => {
                console.log('북마크 에러 발생')
                alert("에러 발생",err);
            })
        })
    })

</script>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
</body>
</html>

</html>