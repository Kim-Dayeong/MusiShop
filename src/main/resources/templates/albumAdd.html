<html lang="ko"
      xmlns:th="http://thymeleaf.org"
      xmlns:layout="http://ultraq.net.nz/thymeleaf/layout"
>
<meta charset="UTF-8">
<head>
    <meta charset="UTF-8">
    <title>앨범 등록 페이지</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>앨범 등록 페이지</h1>

<!-- 앨범 등록 폼 -->
<form th:object="${albumDto}" th:action="@{/album/add}" method="post">

    <!-- 노래 폼 추가 버튼 -->
    <button type="button" id="addSongForm">Add Song</button>

    <!-- 동적으로 추가되는 노래 폼을 담을 컨테이너 -->
    <div id="songFormsContainer"></div>

    <!-- 제출 버튼 -->
    <button type="submit">Submit</button>


    <!-- 노래 폼 템플릿 -->
    <script type="text/template" id="songFormTemplate">
        <div class="song-form">
            <input type="text" name="songDtos[__INDEX__].song_name" placeholder="Song Name">
            <input type="number" name="songDtos[__INDEX__].songdex" placeholder="Song Index">
            <button type="button" class="remove-song-form">Remove</button>
        </div>
    </script>

</form>

<script>
    $(document).ready(function() {
        // 노래 폼 추가 버튼 클릭 시
        $('#addSongForm').click(function() {
            var songFormTemplate = $('#songFormTemplate').html();
            var songFormsContainer = $('#songFormsContainer');
            var newIndex = songFormsContainer.children().length;

            // 노래 폼 템플릿을 동적으로 생성하여 추가
            var songFormHtml = songFormTemplate.replace(/__INDEX__/g, newIndex);
            songFormsContainer.append(songFormHtml);
        });

        // 동적으로 추가한 노래 폼의 삭제 버튼 클릭 시
        $(document).on('click', '.remove-song-form', function() {
            $(this).closest('.song-form').remove();
        });

    });
</script>
<script>
//제출버튼 클릭 시
$('#submit').click(function() {

var songDataArray = [];
$('.song-form').each(function() {
var songName = $(this).find('.song-name').val();
var songIndex = $(this).find('.song-index').val();
songDataArray.push({ song_name: songName, songdex: songIndex });
});

var formData = {
songDtos: songDataArray
};

$.ajax({
type: 'POST',
url: '/album/add',
contentType: 'application/json',
data: JSON.stringify(formData),
success: function(response) {
// 성공적으로 전송되었을 때 처리
window.location.href = '/';
},
error: function(error) {
// 전송 오류 처리
console.error('Error:', error);
}
});
});
</script>


</body>

</html>